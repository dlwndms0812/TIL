### 10.1 무중단 배포 소개

무중단 배포

- 서비스를 정지하지 않고 배포할 수 있는 방법
1. AWS에서 블루 그린 무중단 배포
2. 도커를 이용한 웹서비스 무중단 배포

엔진엑스

- 웹 서버, 리버스 프록시, 캐싱, 로드 밸런싱, 미디어 스트리밍 등을 위한 오픈소스 소프트웨어
- 리버스 프록시: 엔진엑스가 외부의 요청을 받아 백엔드 서버로 요청을 전달하는 행위
- 저렴함

**엔진엑스 무중단 배포1**

![11](https://user-images.githubusercontent.com/57864944/155552873-86768f8c-cf26-4392-9ea3-391f86c79696.png)

1. 사용자는 서비스 주소로 접속(80 혹은 443 포트)
2. 엔진엑스는 사용자의 요청을 받아 현재 연결된 스프링 부트로 요청을 전달
3. 스프링 부트2는 엔진엑스와 연결된 상태가 아니니 요청받지 못함

⇒ 1.1 버전으로 신규 배포가 필요하면, 엔진엑스와 연결되지 않은 스프링 부트2로 배포

**엔진엑스 무중단 배포2**

![22](https://user-images.githubusercontent.com/57864944/155552941-855351a3-772e-4507-8c59-a55b593a6e73.png)
1. 배포하는 동안에도 서비스는 중단 X
2. 배포가 끝나고 정상적으로 스프링부트2가 구동중인지를 확인
3. 스프링부트2가 정상적으로 구동 중이면 nginx reload 명령어를 통해 8081 대신 8082를 바라보도록 함
4. nginx reload는 0.1초 이내에 완료됨

**엔진엑스 무중단 배포3**

![33](https://user-images.githubusercontent.com/57864944/155552948-a7eac859-aeb3-405f-9c6a-6083b51618e9.png)
1. 현재는 엔진엑스와 연결된 것이 스프링부트2
2. 스프링 부트1의 배포가 끝났다면 엔진엑스가 스프링 부트1을 바라보게 변경하고 nginx reload를 실행함
3. 이후 요청부터는 엔진엑스가 스프링 부트1로 요청을 전달함

![44](https://user-images.githubusercontent.com/57864944/155552954-84b3680f-60a4-441a-bc57-10194ecceeda.png)
